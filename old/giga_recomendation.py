import requests
import json
from datetime import datetime
import os
from docx import Document


class MeetingAnalyzer:
    def __init__(self, auth_key, scope, api_auth_url, api_chat_url):
        self.auth_key = auth_key
        self.scope = scope
        self.api_auth_url = api_auth_url
        self.api_chat_url = api_chat_url
        self.access_token = None
        self.token_expires = 0

    def get_access_token(self):
        headers = {
            'Authorization': f'Bearer {self.auth_key}',
            'RqUID': '6f0b1291-c7f3-43c6-bb2e-9f3efb2dc98e',
            'Content-Type': 'application/x-www-form-urlencoded'
        }
        data = {'scope': self.scope}

        response = requests.post(self.api_auth_url, headers=headers, data=data, verify=False)
        if response.status_code == 200:
            token_data = response.json()
            self.access_token = token_data['access_token']
            self.token_expires = datetime.now().timestamp() + int(token_data['expires_at'])
            return True
        else:
            print(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞: {response.status_code} - {response.text}")
            return False

    def is_token_valid(self):
        return self.access_token and datetime.now().timestamp() < self.token_expires

    def read_docx(self, file_path):
        """–ß—Ç–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ —Ñ–∞–π–ª–∞ .docx"""
        if not os.path.exists(file_path):
            raise FileNotFoundError(f"–§–∞–π–ª {file_path} –Ω–µ –Ω–∞–π–¥–µ–Ω")

        doc = Document(file_path)
        full_text = []
        for para in doc.paragraphs:
            full_text.append(para.text)
        return '\n'.join(full_text)

    def analyze_meeting(self):
        if not self.is_token_valid() and not self.get_access_token():
            return "–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞"

        # –ß—Ç–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –≤—Å—Ç—Ä–µ—á–∏ –∏–∑ —Ñ–∞–π–ª–∞
        try:
            trans = self.read_docx('./trans.docx')
        except Exception as e:
            return f"–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞: {str(e)}"

        prompt = f"""–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ç–µ–∫—Å—Ç –≤—Å—Ç—Ä–µ—á–∏ –∏ —Å—Ñ–æ—Ä–º–∏—Ä—É–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ñ–æ—Ä–º–∞—Ç–µ:

–ò—Ç–æ–≥–∏ –ú–ú

–¢–≤–æ–π –≥–æ–ª–æ—Å –∏ —Ä–µ—á—å –±—ã–ª–∏ [–ø–æ–∑–∏—Ç–∏–≤–Ω—ã/–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã/–Ω–µ–≥–∞—Ç–∏–≤–Ω—ã], [–¥–æ–±—Ä–æ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã/—Ñ–æ—Ä–º–∞–ª—å–Ω—ã/—Ö–æ–ª–æ–¥–Ω—ã], [—Ä–∞—Å–ø–æ–ª–∞–≥–∞—é—â–∏–µ –∫ –û–°/–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ/–æ—Ç—Ç–∞–ª–∫–∏–≤–∞—é—â–∏–µ]. 
–¢—ã –≤–æ–≤–ª—ë–∫ –≤ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ [N] –∏–∑ [M] –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –ú–ú–ö. 
–¢—ã [–ø—Ä–æ–ø—É—Å—Ç–∏–ª/–Ω–µ –ø—Ä–æ–ø—É—Å—Ç–∏–ª] –≤–∞–∂–Ω—ã–π —ç—Ç–∞–ø - [–Ω–µ –æ–∑–≤—É—á–∏–ª –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –ú–ú/–æ–∑–≤—É—á–∏–ª –ø—Ä–∞–≤–∏–ª–∞]/—É—á–∞—Å—Ç–Ω–∏–∫–∞–º –≤–∞–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –æ–±—É—á–µ–Ω–∏—è. 
–í –º–æ–º–µ–Ω—Ç –æ–±—Å—É–∂–¥–µ–Ω–∏—è [–Ω–µ –æ–∑–≤—É—á–∏–≤–∞–ª–∏—Å—å/–æ–∑–≤—É—á–∏–≤–∞–ª–∏—Å—å] –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞, —ç—Ç–æ [—Ö–æ—Ä–æ—à–æ/–ø–ª–æ—Ö–æ], –ö–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–µ–≤—ã—à–µ –≤—Å–µ–≥–æ. 
[–°–æ–±–ª—é–¥—ë–Ω —Ç–∞–π–º–∏–Ω–≥/–ù–µ —Å–æ–±–ª—é–¥—ë–Ω, –ø–æ—Ç—Ä–µ–Ω–∏—Ä—É–π—Å—è –∫–æ—Ä–æ—á–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–∏ –º—ã—Å–ª–∏]. 
[–û–¥–∏–Ω/–ù–µ—Å–∫–æ–ª—å–∫–æ/–ù–∏–∫—Ç–æ] –∏–∑ [M] —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ú–ú–ö [–§–ò–û] –ø–æ–≥—Ä—É–∑–∏–ª—Å—è –≤ –±–∏–∑–Ω–µ—Å –∫–ª–∏–µ–Ω—Ç–∞, –µ–≥–æ –∑–∞–¥–∞—á–∏ –∏ –ø–ª–∞–Ω—ã. 
–ü—Ä–∏ —ç—Ç–æ–º [–Ω–µ –ø–æ–≥—Ä—É–∑–∏–ª—Å—è/–ø–æ–≥—Ä—É–∑–∏–ª—Å—è] –≤ –∫–ª–∏–µ–Ω—Ç–∞, –Ω–µ —É–∑–Ω–∞–ª –æ –µ–≥–æ –∏–Ω—Ç–µ—Ä–µ—Å–∞—Ö –∏ —Ö–æ–±–±–∏. 
–£—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –æ –∫–ª–∏–µ–Ω—Ç–µ –∑–∞–¥–∞–≤–∞–ª–∏ [N] –∏–∑ [M] –ú–ú–ö. 
–¢—ã [–Ω–µ –ø—Ä–µ–¥–ª–æ–∂–∏–ª/–ø—Ä–µ–¥–ª–æ–∂–∏–ª] –∫–æ–º–∞–Ω–¥–µ –ø–æ–∏—Å–∫ —Ä–µ—à–µ–Ω–∏—è, —á—Ç–æ [–Ω–µ –ø–æ–∑–≤–æ–ª–∏–ª–æ/–ø–æ–∑–≤–æ–ª–∏–ª–æ] —Ç–µ–±–µ –≤–æ–≤–ª–µ—á—å –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤. 
–ü—Ä–∏ —ç—Ç–æ–º —Ç–æ–±–æ–π [–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å —Å–ª–æ–≤–∞ –ø–∞—Ä–∞–∑–∏—Ç—ã (–±–æ–ª–µ–µ 3 —Ä–∞–∑)/–Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Å–ª–æ–≤–∞ –ø–∞—Ä–∞–∑–∏—Ç—ã (–±–æ–ª–µ–µ 3 —Ä–∞–∑)]. 
–¢—ã [–ø–µ—Ä–µ–±–∏–≤–∞–ª/–Ω–µ –ø–µ—Ä–µ–±–∏–≤–∞–ª] —Ä–µ—á—å [–§–ò–û]. 
–í –∏—Ç–æ–≥–µ [—Ä–µ–±—è—Ç–∞ –Ω–µ —Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–ª–∏ —Å–≤–æ—é –∏–¥–µ—é/–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è/—Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–ª–∏ —Å–≤–æ–∏ –∏–¥–µ–∏]. 
[–ë—ã–ª–∏/–ù–µ –±—ã–ª–æ] –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–ª—É—à–∞–Ω–∏—è. 
–ü–æ –∏—Ç–æ–≥–∞–º –ú–ú [N] –∏–∑ [M] —Ä–µ–±—è—Ç –Ω–µ —Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–ª–∏ —Ü–µ–Ω–Ω–æ—Å—Ç—å –≤—Å—Ç—Ä–µ—á–∏. –ò –Ω–µ –ø–æ–¥–µ–ª–∏–ª–∏—Å—å —Å–≤–æ–∏–º–∏ –º—ã—Å–ª—è–º–∏.

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –†–ú

–¢–µ–±–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:

1. [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 1]
2. [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 2]
3. [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 3]
4. [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 4]

–¢–µ–∫—Å—Ç –≤—Å—Ç—Ä–µ—á–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:
{trans}"""

        return self._send_request(prompt)

    def _send_request(self, prompt):
        """–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ GigaChat API"""
        headers = {
            'Authorization': f'Bearer {self.access_token}',
            'Content-Type': 'application/json'
        }

        payload = {
            "model": "GigaChat",
            "messages": [
                {
                    "role": "user",
                    "content": prompt
                }
            ],
            "temperature": 0.7,
            "top_p": 0.9,
            "n": 1,
            "stream": False,
            "max_tokens": 4000,
            "repetition_penalty": 1.0
        }

        response = requests.post(self.api_chat_url, headers=headers, json=payload, verify=False)
        if response.status_code == 200:
            result = response.json()
            return result['choices'][0]['message']['content']
        else:
            return f"–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ –≤—Å—Ç—Ä–µ—á–∏: {response.status_code} - {response.text}"

    def analyze_meeting_with_file(self, file_path):
        """–ê–Ω–∞–ª–∏–∑ –≤—Å—Ç—Ä–µ—á–∏ —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º —Ñ–∞–π–ª–æ–º –∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π"""
        if not self.is_token_valid() and not self.get_access_token():
            return "–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞"

        # –ß—Ç–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –≤—Å—Ç—Ä–µ—á–∏ –∏–∑ —Ñ–∞–π–ª–∞
        try:
            trans = self.read_docx(file_path)
        except Exception as e:
            return f"–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞: {str(e)}"

        # –ß–∏—Ç–∞–µ–º –æ—Ç—á–µ—Ç –ø–æ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è–º (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
        competency_report = ""
        try:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è —Ñ–∞–π–ª–∞ –æ—Ç—á–µ—Ç–∞
            report_files = ['REPORT.txt', './REPORT.txt', 'REPORT_backup.txt', './REPORT_backup.txt']
            report_found = False
            
            print("üîç –ü–æ–∏—Å–∫ —Ñ–∞–π–ª–∞ –æ—Ç—á–µ—Ç–∞ –ø–æ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è–º...")
            for report_file in report_files:
                abs_path = os.path.abspath(report_file)
                print(f"   –ü—Ä–æ–≤–µ—Ä—è—é: {abs_path}")
                if os.path.exists(report_file):
                    print(f"‚úÖ –ù–∞–π–¥–µ–Ω —Ñ–∞–π–ª: {report_file}")
                    with open(report_file, 'r', encoding='utf-8') as f:
                        competency_report = f.read()
                    report_found = True
                    break
                else:
                    print(f"‚ùå –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {report_file}")
            
            if not report_found:
                # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
                current_dir = os.getcwd()
                print(f"\nüìÅ –¢–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: {current_dir}")
                print("üìÇ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:")
                try:
                    for item in os.listdir('.'):
                        if os.path.isfile(item):
                            size = os.path.getsize(item)
                            print(f"   üìÑ {item} ({size} –±–∞–π—Ç)")
                        else:
                            print(f"   üìÅ {item}/")
                except Exception as list_error:
                    print(f"   ‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏: {list_error}")
                
                return "‚ùå –û–®–ò–ë–ö–ê: –§–∞–π–ª –æ—Ç—á–µ—Ç–∞ –ø–æ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è–º –Ω–µ –Ω–∞–π–¥–µ–Ω!\n\n" + \
                       "üîß –†–ï–®–ï–ù–ò–Ø:\n" + \
                       "1. –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∞–Ω–∞–ª–∏–∑ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π (search_optimized.py)\n" + \
                       "2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª REPORT.txt —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏\n" + \
                       "3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º\n" + \
                       f"4. –¢–µ–∫—É—â–∞—è —Ä–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: {current_dir}"
            
            # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –æ—Ç—á–µ—Ç —á—Ç–æ–±—ã –ø–æ–¥—Å—á–∏—Ç–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π
            competency_count = competency_report.count("üèÜ")
            print(f"üìä –ù–ê–ô–î–ï–ù–û –ö–û–ú–ü–ï–¢–ï–ù–¶–ò–ô –í –û–¢–ß–ï–¢–ï: {competency_count}")
            
            # –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π –¥–ª—è –≤—ã–≤–æ–¥–∞
            import re
            competencies = re.findall(r'üèÜ (.+?) - —Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª', competency_report)
            print("üìã –°–ü–ò–°–û–ö –ö–û–ú–ü–ï–¢–ï–ù–¶–ò–ô:")
            for i, comp in enumerate(competencies, 1):
                print(f"   {i}. {comp}")
            print(f"\nüéØ GigaChat –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –í–°–ï–• {competency_count} –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π!")
                       
        except Exception as e:
            return f"‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –æ—Ç—á–µ—Ç–∞ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π: {str(e)}"

        prompt = f"""–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ç–µ–∫—Å—Ç –≤—Å—Ç—Ä–µ—á–∏ –∏ –æ—Ç—á–µ—Ç –ø–æ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è–º, –∑–∞—Ç–µ–º —Å—Ñ–æ—Ä–º–∏—Ä—É–π –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

# –î–ï–¢–ê–õ–¨–ù–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –†–ê–ó–í–ò–¢–ò–Æ

## –ê–Ω–∞–ª–∏–∑ –≤—Å—Ç—Ä–µ—á–∏ –∏ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π

[–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è, —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤—Å—Ç—Ä–µ—á–∏, –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤]

## –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ö–û–ú–ü–ï–¢–ï–ù–¶–ò–Ø–ú

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è:

**–í–ê–ñ–ù–û:** –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –í–°–ï –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏ –∏–∑ –æ—Ç—á–µ—Ç–∞ –∏ —Å–æ–∑–¥–∞–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ö–ê–ñ–î–û–ô –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏, –Ω–∞–π–¥–µ–Ω–Ω–æ–π –≤ –æ—Ç—á–µ—Ç–µ –ø–æ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è–º. –ò—Å–ø–æ–ª—å–∑—É–π —Å–ª–µ–¥—É—é—â–∏–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –ö–ê–ñ–î–û–ô –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏:

**[–ù–æ–º–µ—Ä]. [–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏]** - [–¢–û–ß–ù–´–ô –±–∞–ª–ª –∏–∑ –æ—Ç—á–µ—Ç–∞]/10
   - üìä **–¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å:** [–û–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –∏ –±–∞–ª–ª–∞]
   - üìö **–ö—É—Ä—Å—ã –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è:** (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∏—Å–ø–æ–ª—å–∑—É–π –∫—É—Ä—Å—ã –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ "üí° –†–ï–ö–û–ú–ï–ù–î–û–í–ê–ù–ù–´–ï –ö–£–†–°–´ (–ò–ó EXCEL)" –æ—Ç—á–µ—Ç–∞)
     - [–¢–û–ß–ù–û–ï –Ω–∞–∑–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞ –∏–∑ –æ—Ç—á–µ—Ç–∞] - [–æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –∏–∑ Excel —Ñ–∞–π–ª–∞]
     - –ù–ï –î–û–ë–ê–í–õ–Ø–ô –∫—É—Ä—Å—ã –æ—Ç —Å–µ–±—è - –∏—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û –∏–∑ –æ—Ç—á–µ—Ç–∞!
   - üí° **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
     - [–ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 1]
     - [–ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 2]
     - [–ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 3]
   - üéØ **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** [–ß—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—Å—è –ø–æ—Å–ª–µ —Ä–∞–∑–≤–∏—Ç–∏—è]
   - ‚ùå **–ü—Ä–∏–º–µ—Ä—ã –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö —Ñ—Ä–∞–∑ –∏–∑ –≤—Å—Ç—Ä–µ—á–∏:** (–∏—Å–ø–æ–ª—å–∑—É–π —Ñ—Ä–∞–∑—ã –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ "‚ùå –ù–ê–ô–î–ï–ù–û –í –¢–ï–ö–°–¢–ï (–Ω–µ–≥–∞—Ç–∏–≤–Ω–æ–µ)" –≤ –æ—Ç—á–µ—Ç–µ)
     - –¶–∏—Ç–∞—Ç–∞: "[—Ç–æ—á–Ω–∞—è —Ü–∏—Ç–∞—Ç–∞ –∏–∑ –æ—Ç—á–µ—Ç–∞]" ‚Üí –ú–æ–≥ –±—ã —Å–∫–∞–∑–∞—Ç—å: "[–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è —Ñ—Ä–∞–∑–∞]"
   - ‚úÖ **–ü—Ä–∏–º–µ—Ä—ã –ø–æ–∑–∏—Ç–∏–≤–Ω—ã—Ö —Ñ—Ä–∞–∑ –∏–∑ –≤—Å—Ç—Ä–µ—á–∏:** (–∏—Å–ø–æ–ª—å–∑—É–π —Ñ—Ä–∞–∑—ã –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ "‚úÖ –ù–ê–ô–î–ï–ù–û –í –¢–ï–ö–°–¢–ï (–ø–æ–∑–∏—Ç–∏–≤–Ω–æ–µ)" –≤ –æ—Ç—á–µ—Ç–µ)
     - –¶–∏—Ç–∞—Ç–∞: "[—Ç–æ—á–Ω–∞—è —Ü–∏—Ç–∞—Ç–∞ –∏–∑ –æ—Ç—á–µ—Ç–∞]" - –æ—Ç–ª–∏—á–Ω–æ —Å–∫–∞–∑–∞–Ω–æ!

–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û —Å–æ–∑–¥–∞–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –í–°–ï–• –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π –∏–∑ –æ—Ç—á–µ—Ç–∞, –¥–∞–∂–µ –µ—Å–ª–∏ –±–∞–ª–ª —Ä–∞–≤–µ–Ω 0.

## –û–ë–©–ò–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –í–°–¢–†–ï–ß–ï

### –ß—Ç–æ —É–ª—É—á—à–∏—Ç—å –≤ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–∏ –≤—Å—Ç—Ä–µ—á:

1. [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –≤—Å—Ç—Ä–µ—á–∏]
2. [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –ø–æ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏]
3. [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –ø–æ –≤–æ–≤–ª–µ—á–µ–Ω–∏—é —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤]

## –ü–õ–ê–ù –†–ê–ó–í–ò–¢–ò–Ø –ù–ê –ë–õ–ò–ñ–ê–ô–®–ò–ô –ú–ï–°–Ø–¶

**–ò–ù–°–¢–†–£–ö–¶–ò–Ø:** –°–æ–∑–¥–∞–π –ø–ª–∞–Ω —Ä–∞–∑–≤–∏—Ç–∏—è, –∫–æ—Ç–æ—Ä—ã–π –æ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –í–°–ï –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏ –∏–∑ –æ—Ç—á–µ—Ç–∞. –†–∞—Å–ø—Ä–µ–¥–µ–ª–∏ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏ –ø–æ –Ω–µ–¥–µ–ª—è–º –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∏—Ö –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ—Å—Ç–∏:

### –ù–µ–¥–µ–ª—è 1: [–ù–∞–∑–≤–∞–Ω–∏–µ —Å–∞–º–æ–π –ø—Ä–æ–±–ª–µ–º–Ω–æ–π –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏ (—Å —Å–∞–º—ã–º –Ω–∏–∑–∫–∏–º –±–∞–ª–ª–æ–º)]
- [–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è —ç—Ç–æ–π –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏]
- [–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è]
- [–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ –∫—É—Ä—Å—ã –Ω–∞ —ç—Ç—É –Ω–µ–¥–µ–ª—é]

### –ù–µ–¥–µ–ª—è 2: [–ù–∞–∑–≤–∞–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–π –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É]
- [–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è —ç—Ç–æ–π –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏]
- [–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è]
- [–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ –∫—É—Ä—Å—ã –Ω–∞ —ç—Ç—É –Ω–µ–¥–µ–ª—é]

### –ù–µ–¥–µ–ª—è 3: [–ù–∞–∑–≤–∞–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–π –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏ –∏–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö]
- [–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è]
- [–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è]
- [–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ –∫—É—Ä—Å—ã –Ω–∞ —ç—Ç—É –Ω–µ–¥–µ–ª—é]

### –ù–µ–¥–µ–ª—è 4: [–ó–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π –∏–ª–∏ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏]
- [–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è –ø–æ –≤—Å–µ–º –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è–º]
- [–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è]
- [–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è]

**–ü–†–ò–ú–ï–ß–ê–ù–ò–ï:** –ï—Å–ª–∏ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π –±–æ–ª—å—à–µ 4, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏ –∏—Ö –ª–æ–≥–∏—á–Ω–æ –ø–æ –Ω–µ–¥–µ–ª—è–º –∏–ª–∏ —Å–æ–∑–¥–∞–π –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–µ–¥–µ–ª–∏.

## –ú–ï–¢–†–ò–ö–ò –£–°–ü–ï–•–ê

- [–ò–∑–º–µ—Ä–∏–º–∞—è —Ü–µ–ª—å 1]
- [–ò–∑–º–µ—Ä–∏–º–∞—è —Ü–µ–ª—å 2]
- [–ò–∑–º–µ—Ä–∏–º–∞—è —Ü–µ–ª—å 3]

---

**–¢–µ–∫—Å—Ç –≤—Å—Ç—Ä–µ—á–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:**
{trans}

**–û—Ç—á–µ—Ç –ø–æ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è–º:**
{competency_report}

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:** 
1. –û–±—Ä–∞–±–æ—Ç–∞–π –ö–ê–ñ–î–£–Æ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—é –∏–∑ –æ—Ç—á–µ—Ç–∞ - –ù–ï –ø—Ä–æ–ø—É—Å–∫–∞–π –Ω–∏ –æ–¥–Ω–æ–π!
2. –ï—Å–ª–∏ –≤–∏–¥–∏—à—å 4 –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏ –≤ –æ—Ç—á–µ—Ç–µ - —Å–æ–∑–¥–∞–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö 4!
3. –ï—Å–ª–∏ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π –±—É–¥–µ—Ç –±–æ–ª—å—à–µ (5, 6, 7...) - –æ–±—Ä–∞–±–æ—Ç–∞–π –≤—Å–µ!
4. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∏—Å–ø–æ–ª—å–∑—É–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ñ—Ä–∞–∑—ã –∏–∑ —Ä–∞–∑–¥–µ–ª–æ–≤ "‚ùå –ù–ê–ô–î–ï–ù–û –í –¢–ï–ö–°–¢–ï (–Ω–µ–≥–∞—Ç–∏–≤–Ω–æ–µ)" –∏ "‚úÖ –ù–ê–ô–î–ï–ù–û –í –¢–ï–ö–°–¢–ï (–ø–æ–∑–∏—Ç–∏–≤–Ω–æ–µ)" –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∏–º–µ—Ä–æ–≤ "–º–æ–≥ –±—ã —Å–∫–∞–∑–∞—Ç—å —Ç–∞–∫".
5. –ù–∞—á–Ω–∏ –æ—Ç–≤–µ—Ç —Å—Ä–∞–∑—É —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞ "# –î–ï–¢–ê–õ–¨–ù–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –†–ê–ó–í–ò–¢–ò–Æ".

**–°–¢–†–û–ì–ò–ï –ü–†–ê–í–ò–õ–ê –î–õ–Ø –ë–ê–õ–õ–û–í –ò –ö–£–†–°–û–í:**
1. üéØ –ë–ê–õ–õ–´: –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–ß–ù–´–ï –±–∞–ª–ª—ã –∏–∑ –æ—Ç—á–µ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –Ω–∞–ø–∏—Å–∞–Ω–æ "—Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª 0.0" - –ø–∏—à–∏ 0.0, –µ—Å–ª–∏ "-2.1" - –ø–∏—à–∏ -2.1)
2. üìö –ö–£–†–°–´: –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û –∫—É—Ä—Å—ã –∏–∑ —Ä–∞–∑–¥–µ–ª–æ–≤ "üí° –†–ï–ö–û–ú–ï–ù–î–û–í–ê–ù–ù–´–ï –ö–£–†–°–´ (–ò–ó EXCEL)" - –ù–ï –¥–æ–±–∞–≤–ª—è–π —Å–≤–æ–∏!
3. üö´ –ù–ï –ü–†–ò–î–£–ú–´–í–ê–ô –∫—É—Ä—Å—ã –æ—Ç —Å–µ–±—è - –µ—Å–ª–∏ –≤ –æ—Ç—á–µ—Ç–µ –Ω–µ—Ç –∫—É—Ä—Å–æ–≤ –¥–ª—è –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏, –Ω–∞–ø–∏—à–∏ "–ö—É—Ä—Å—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã –≤ Excel —Ñ–∞–π–ª–µ"
4. üìä –ù–ï –û–ö–†–£–ì–õ–Ø–ô –∏ –ù–ï –ò–ó–ú–ï–ù–Ø–ô –±–∞–ª–ª—ã - –∫–æ–ø–∏—Ä—É–π –∏—Ö —Ç–æ—á–Ω–æ –∫–∞–∫ –≤ –æ—Ç—á–µ—Ç–µ

**–ü–†–û–í–ï–†–¨ –°–ï–ë–Ø:** 
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π = –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –≤ –æ—Ç—á–µ—Ç–µ
- –ë–∞–ª–ª—ã —Ç–æ—á–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ –æ—Ç—á–µ—Ç–∞  
- –ö—É—Ä—Å—ã –≤–∑—è—Ç—ã —Ç–æ–ª—å–∫–æ –∏–∑ –æ—Ç—á–µ—Ç–∞"""

        return self._send_request(prompt)


# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
if __name__ == "__main__":
    AUTH_KEY = 'ZGMzMGJmZjEtODQwYS00ZjAwLWI2NjgtNGIyNGNiY2ViNmE1OjYwNjM3NTU0LWQxMDctNDA5ZS1hZWM3LTAwYjQ5MjZkOGU2OA=='
    SCOPE = 'GIGACHAT_API_PERS'
    API_AUTH_URL = 'https://ngw.devices.sberbank.ru:9443/api/v2/oauth'
    API_CHAT_URL = 'https://gigachat.devices.sberbank.ru/api/v1/chat/completions'

    analyzer = MeetingAnalyzer(AUTH_KEY, SCOPE, API_AUTH_URL, API_CHAT_URL)

    try:
        analysis_result = analyzer.analyze_meeting()
        print("–†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞ –≤—Å—Ç—Ä–µ—á–∏:")
        print(analysis_result)

        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ —Ñ–∞–π–ª
        with open('meeting_analysis.txt', 'w', encoding='utf-8') as f:
            f.write(analysis_result)
        print("\n–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ —Ñ–∞–π–ª meeting_analysis.txt")

    except Exception as e:
        print(f"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: {str(e)}")